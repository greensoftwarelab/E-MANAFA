

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>E-MANAFA: Energy Monitor and ANAlyzer For Android &mdash; e-manafa 0.3.5 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="manafa" href="modules.html" />
    <link rel="prev" title="Welcome to E-MANAFA’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> e-manafa
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">E-MANAFA: Energy Monitor and ANAlyzer For Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="#setup">SETUP</a></li>
<li class="toctree-l1"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#via-python-pip">1. Via python-pip</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-environment-variables">1.1 define environment variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#from-sources">2. From sources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clone-repo">2.1 Clone repo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#replicate-the-environment">2.2 Replicate the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#replicate-locally-the-dev-virtualenv">2.3 Replicate locally the dev virtualenv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#activate-the-virtual-environment">2.4 Activate the virtual environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-required-packages">2.6 Install required packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">2.6 define environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#command-line">Command line</a></li>
<li class="toctree-l2"><a class="reference internal" href="#source">Source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#supported-devices">Supported devices:</a></li>
<li class="toctree-l1"><a class="reference internal" href="#todo">TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">manafa</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">e-manafa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>E-MANAFA: Energy Monitor and ANAlyzer For Android</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p><a class="reference external" href="https://travis-ci.com/RRua/e-manafa"><img alt="Build Status" src="https://travis-ci.com/RRua/e-manafa.svg?branch=main" /></a>
<a class="reference external" href="https://www.python.org/"><img alt="made-with-python" src="https://img.shields.io/badge/Made%20with-Python-1f425f.svg" /></a>
<a class="reference external" href="https://badge.fury.io/py/manafa"><img alt="PyPI version" src="https://badge.fury.io/py/manafa.svg" /></a>
<a class="reference external" href="https://pypi.python.org/pypi/manafa"><img alt="PyPI license" src="https://img.shields.io/pypi/l/ansicolortags.svg" /></a>
<a class="reference external" href="https://pypi.python.org/pypi/manafa"><img alt="PyPI status" src="https://img.shields.io/pypi/status/ansicolortags.svg" /></a></p>
<div class="section" id="e-manafa-energy-monitor-and-analyzer-for-android">
<h1>E-MANAFA: Energy Monitor and ANAlyzer For Android<a class="headerlink" href="#e-manafa-energy-monitor-and-analyzer-for-android" title="Permalink to this headline">¶</a></h1>
<p>E-MANAFA is a plug-and-play software model-based tool for performing fine-grained estimates of energy consumption on Android devices. E-Manafa estimates system-level  and per-component energy consumption, by extracting information from the following sources:</p>
<ul class="simple">
<li><p>power_profile.xml: Device-specific file provided by manufacturers containing current consumption per component state;</p></li>
<li><p>batterystats: Tool from Android framework that logs each power-related event that occurs between device charges;</p></li>
<li><p>Perfetto: System-wide profiling for Linux and Android, that profiles high-frequency data, such as CPU frequency.</p></li>
</ul>
<p>Note: Manufacturers not always supply information about the current consumed by an individual component in the power profile file. Use this information if it accurately represents the current drawn from the device battery in practice. The file can also be derived using external apparatus such as Monsoon. Google provides a set of guidelines to estimating the current of each component (https://source.android.com/devices/tech/power/component)</p>
</div>
<div class="section" id="setup">
<h1>SETUP<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<p>In order to run this tool, the following resources are required:</p>
<ul class="simple">
<li><p>rooted Android device (running Android 9 or above);</p></li>
<li><p>*nix-based environment (MAC OS , Linux);</p></li>
<li><p>Python 3.6 or above;</p></li>
<li><p>Android Sdk tools (https://developer.android.com/studio/releases/platform-tools)</p></li>
</ul>
</div>
<div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="via-python-pip">
<h2>1. Via python-pip<a class="headerlink" href="#via-python-pip" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">manafa</span>
</pre></div>
</div>
<div class="section" id="define-environment-variables">
<h3>1.1 define environment variables<a class="headerlink" href="#define-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>In order to run this tool, there are at least 2 env. variables that need to be defined in the shell startup script (e.g .bashrc or .bash_profile file)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export ANDROID_HOME=$HOME/&lt;your-android-instalation-folder&gt;/ 
export PATH=$ANDROID_HOME/platform-tools:$PATH
</pre></div>
</div>
</div>
</div>
<div class="section" id="from-sources">
<h2>2. From sources<a class="headerlink" href="#from-sources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="clone-repo">
<h3>2.1 Clone repo<a class="headerlink" href="#clone-repo" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/RRua/e-manafa.git
</pre></div>
</div>
</div>
<div class="section" id="replicate-the-environment">
<h3>2.2 Replicate the environment<a class="headerlink" href="#replicate-the-environment" title="Permalink to this headline">¶</a></h3>
<p>Install virtual virtualenv enviroment  (via python-pip):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m pip install --user virtualenv
</pre></div>
</div>
</div>
<div class="section" id="replicate-locally-the-dev-virtualenv">
<h3>2.3 Replicate locally the dev virtualenv<a class="headerlink" href="#replicate-locally-the-dev-virtualenv" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ virtualenv env/
</pre></div>
</div>
</div>
<div class="section" id="activate-the-virtual-environment">
<h3>2.4 Activate the virtual environment<a class="headerlink" href="#activate-the-virtual-environment" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source env/bin/activate
</pre></div>
</div>
</div>
<div class="section" id="install-required-packages">
<h3>2.6 Install required packages<a class="headerlink" href="#install-required-packages" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install -r requirements.txt
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>2.6 define environment variables<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In order to run this tool, there are at least 2 env. variables that need to be defined in the shell startup script (e.g .bashrc or .bash_profile file)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export ANDROID_HOME=$HOME/&lt;your-android-instalation-folder&gt;/ 
export PATH=$ANDROID_HOME/platform-tools:$PATH
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="command-line">
<h2>Command line<a class="headerlink" href="#command-line" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python emanafa.py [-p|--profile &lt;prof&gt;] 
            [-t|--timezone &lt;tz&gt;] 
            [-pft|--perfettofile &lt;pf&gt;] 
            [-bts|--batstatsfile &lt;bf&gt;] 
</pre></div>
</div>
</div>
<div class="section" id="source">
<h2>Source<a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example </span>
<span class="n">em</span> <span class="o">=</span> <span class="n">EManafa</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">do_work_to_profile</span><span class="p">()</span> <span class="c1"># replace by procedure to be measured </span>
<span class="n">em</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="n">em</span><span class="o">.</span><span class="n">parseResults</span><span class="p">()</span>
<span class="n">begin</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">bat_events</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>  <span class="c1"># first collected sample from batterystats</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">bat_events</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>  <span class="c1"># last collected sample from batterystats</span>
<span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">getConsumptionInBetween</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TOTAL: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> Joules&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="supported-devices">
<h1>Supported devices:<a class="headerlink" href="#supported-devices" title="Permalink to this headline">¶</a></h1>
<p>This tool can be used with any Android device able to run Perfetto, available since Android 9 (P). The tool so far was successfuly executed on the following devices:</p>
<ul class="simple">
<li><p>Pixel 3a</p></li>
<li><p>Pixel 4a 5G</p></li>
<li><p>Xiaomi Mi 9 Lite</p></li>
</ul>
</div>
<div class="section" id="todo">
<h1>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>support for memory power calculator (MemoryPowerCalculator is a new addition in 8.0, mainly to count the power consumption on DDR memory . formula: MemoryPower = (mAatRail_1 * timeMs_1 + mAatRail_2 * timeMs_2 +… + mAatRail_n * timeMs_n) / (1000 * 60 * 60) (mAatRail_n: is the power at the read/write rate level, timeMs_n: is the time at the mAatRail_n level))</p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="modules.html" class="btn btn-neutral float-right" title="manafa" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to E-MANAFA’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Rui Rua.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>